<Project Sdk="Microsoft.NET.Sdk" DefaultTargets="BuildRuntime">

  <!-- Public properties to configure runtime build. -->
  <PropertyGroup>
    <TargetFramework>netcoreapp3.1</TargetFramework>
  </PropertyGroup>

  <!-- Internal properties. Do not change manually. -->
  <PropertyGroup>
    <OutDir>$(MSBuildThisFileDirectory)/build</OutDir>
    <BaseGmodNETPublishInst>dotnet publish gm_dotnet_managed/GmodNET/GmodNET.csproj -c $(Configuration) -o $(OutDir)/gmodnet</BaseGmodNETPublishInst>
    <GmodNETAPIBuildInst>dotnet build gm_dotnet_managed/GmodNET.API/GmodNET.API.csproj -c $(Configuration) -o $(OutDir)/gmodnet/API</GmodNETAPIBuildInst>
  </PropertyGroup>
  
  <ItemGroup>
    
  </ItemGroup>

  <Target Name="BuildRuntime">
    <Message Text="Starting GmodNET Runtime build process" Importance="high" />
    <Message Text="Executing '$(BaseGmodNETPublishInst)" Importance="high" />
    <Exec Command="$(BaseGmodNETPublishInst)" ConsoleToMsBuild="true" />
    <Delete Files="build/gmodnet/GmodNET.exe;build/gmodnet/GmodNET;build/gmodnet/web.config" />
    <Message Text="Executing $(GmodNETAPIBuildInst)" Importance="high" />
    <Exec Command="$(GmodNETAPIBuildInst)" ConsoleToMsBuild="true" />
  </Target>

</Project>
